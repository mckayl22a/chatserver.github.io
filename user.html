<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Page - GurtChat</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="user-container" id="user-container" style="display:none;">
  <h1 id="user-title"></h1>
  <p id="user-email"></p>
  <button id="logout-btn">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

const firebaseConfig = { /* same as index.html */ };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const container = document.getElementById("user-container");
const title = document.getElementById("user-title");
const emailP = document.getElementById("user-email");

onAuthStateChanged(auth, async (user)=>{
  if(!user){
    localStorage.removeItem("gurtchat_username");
    window.location.href="index.html";
    return;
  }

  container.style.display="block";
  let username = localStorage.getItem("gurtchat_username");
  if(!username){
    const snapshot = await get(child(ref(db), `users/${user.uid}/username`));
    if(snapshot.exists()) username=snapshot.val();
    localStorage.setItem("gurtchat_username", username);
  }
  title.textContent = `Logged in as: ${username}`;
  emailP.textContent = `Email: ${user.email}`;

  document.getElementById("logout-btn").addEventListener("click", async ()=>{
    await signOut(auth);
    localStorage.removeItem("gurtchat_username");
    window.location.href="index.html";
  });
});
</script>
</body>
</html>
